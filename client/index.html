<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LIGHTS OUT</title>
  <link rel="icon" type="image/svg+xml" href="favicon.svg">
  <link rel="stylesheet" href="css/reset.css">
  <link rel="stylesheet" href="css/variables.css">
  <link rel="stylesheet" href="css/layout.css">
  <link rel="stylesheet" href="css/lobby.css">
  <link rel="stylesheet" href="css/game.css">
  <link rel="stylesheet" href="css/hud.css">
  <link rel="stylesheet" href="css/effects.css">
</head>
<body>
  <!-- Menu Screen -->
  <div id="menu-screen" class="screen active">
    <div class="menu-container">
      <h1 class="game-title">LIGHTS OUT</h1>
      <p class="tagline">"In the dark, everyone's a target."</p>

      <div class="menu-form">
        <input type="text" id="player-name" placeholder="Auto-named if empty" maxlength="12" autocomplete="off" aria-label="Enter your player name">

        <div class="menu-buttons">
          <button id="create-room-btn" class="btn btn-primary" aria-label="Create a new game room">Create Room</button>
          <div class="menu-divider">or</div>
          <div class="join-room-group">
            <input type="text" id="room-code-input" placeholder="CODE" maxlength="4" autocomplete="off" aria-label="Enter 4-letter room code">
            <button id="join-room-btn" class="btn btn-secondary" aria-label="Join existing room">Join</button>
          </div>
        </div>
      </div>

      <p id="menu-error" class="error-message" aria-live="polite" role="alert"></p>

      <div class="menu-info-buttons">
        <button id="how-to-play-btn" class="btn btn-secondary btn-small" aria-label="Open how to play guide">How to Play</button>
        <button id="controls-btn" class="btn btn-secondary btn-small" aria-label="Open controls settings">Controls</button>
      </div>
    </div>
  </div>

  <!-- How to Play Modal -->
  <div id="how-to-play-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="how-to-play-modal-title">
    <div class="modal-content how-to-play-content">
      <h2 id="how-to-play-modal-title">How to Play</h2>

      <div class="how-to-play-section">
        <h3>Objective</h3>
        <p>Be the last player standing in a dark arena pillow fight.</p>
      </div>

      <div class="how-to-play-section">
        <h3>Core Mechanic</h3>
        <p>The arena is pitch black. Use your flashlight to spot enemies - but beware, they'll see your light too!</p>
      </div>

      <div class="how-to-play-section">
        <h3>Tips</h3>
        <ul class="tips-list">
          <li><span class="tip-icon">&#128294;</span> Flashlight reveals enemies but exposes your position</li>
          <li><span class="tip-icon">&#128066;</span> Listen for footsteps to locate nearby players</li>
          <li><span class="tip-icon">&#128716;</span> Pick up pillows scattered around to throw</li>
          <li><span class="tip-icon">&#127939;</span> Sprinting is faster but louder</li>
          <li><span class="tip-icon">&#9201;</span> When time runs out, sudden death shrinks the arena</li>
        </ul>
      </div>

      <div class="how-to-play-section">
        <h3>Quick Controls</h3>
        <div class="quick-controls">
          <div class="quick-control"><kbd>WASD</kbd> <span>Move</span></div>
          <div class="quick-control"><kbd>Space</kbd> <span>Throw pillow</span></div>
          <div class="quick-control"><kbd>F</kbd> <span>Toggle flashlight</span></div>
          <div class="quick-control"><kbd>Shift</kbd> <span>Sprint</span></div>
        </div>
      </div>

      <div class="modal-buttons">
        <button id="close-how-to-play-btn" class="btn btn-primary" aria-label="Close how to play guide">Done</button>
      </div>
    </div>
  </div>

  <!-- Controls Modal -->
  <div id="controls-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="controls-modal-title">
    <div class="modal-content">
      <h2 id="controls-modal-title">Controls</h2>
      <p class="modal-subtitle">Click a key to rebind. Press Escape to cancel.</p>

      <div class="controls-list">
        <div class="control-row" data-action="up">
          <span class="control-label">Move Up</span>
          <div class="control-keys"></div>
        </div>
        <div class="control-row" data-action="down">
          <span class="control-label">Move Down</span>
          <div class="control-keys"></div>
        </div>
        <div class="control-row" data-action="left">
          <span class="control-label">Move Left</span>
          <div class="control-keys"></div>
        </div>
        <div class="control-row" data-action="right">
          <span class="control-label">Move Right</span>
          <div class="control-keys"></div>
        </div>
        <div class="control-row" data-action="sprint">
          <span class="control-label">Sprint</span>
          <div class="control-keys"></div>
        </div>
        <div class="control-row" data-action="throw">
          <span class="control-label">Throw Pillow</span>
          <div class="control-keys"></div>
        </div>
        <div class="control-row" data-action="flashlight">
          <span class="control-label">Toggle Flashlight</span>
          <div class="control-keys"></div>
        </div>
        <div class="control-row" data-action="pause">
          <span class="control-label">Pause</span>
          <div class="control-keys"></div>
        </div>
      </div>

      <div class="modal-buttons">
        <button id="reset-controls-btn" class="btn btn-danger" aria-label="Reset controls to default settings">Reset to Default</button>
        <button id="close-controls-btn" class="btn btn-primary" aria-label="Close controls menu">Done</button>
      </div>
    </div>
  </div>

  <!-- Lobby Screen -->
  <div id="lobby-screen" class="screen">
    <div class="lobby-container">
      <h1 class="lobby-title">LIGHTS OUT</h1>
      <div class="lobby-header">
        <span class="room-code-label">Room</span>
        <div id="room-code-display" class="room-code" aria-live="polite" aria-label="Room code">----</div>
        <button id="copy-code-btn" class="btn btn-small" aria-label="Copy room code to clipboard">Copy</button>
      </div>

      <div class="players-list" id="players-list" role="list" aria-label="Players in lobby">
        <!-- Player items will be inserted here -->
      </div>

      <div class="lobby-settings" id="lobby-settings">
        <label>
          Lives: <input type="number" id="lives-setting" min="1" max="5" value="3" aria-label="Number of lives per player">
        </label>
        <label>
          Time (sec): <input type="number" id="time-setting" min="60" max="300" step="30" value="180" aria-label="Game time limit in seconds">
        </label>
      </div>

      <div class="lobby-buttons">
        <button id="ready-btn" class="btn btn-primary" aria-label="Toggle ready status">Ready</button>
        <button id="start-btn" class="btn btn-success" disabled aria-label="Start the game">Start Game</button>
        <button id="leave-btn" class="btn btn-danger" aria-label="Leave the lobby">Leave</button>
      </div>

      <p id="lobby-status" class="status-message" aria-live="polite"></p>
    </div>
  </div>

  <!-- Game Screen -->
  <div id="game-screen" class="screen">
    <!-- HUD Top -->
    <div id="hud-top">
      <div id="hud-left">
        <div id="hearts-display" aria-label="3 lives remaining">♥♥♥</div>
        <div id="ammo-display" aria-label="Ammo status">●</div>
        <div id="player-name-display"></div>
      </div>
      <div id="hud-right">
        <div id="fps-display" class="debug-info" aria-hidden="true">-- FPS</div>
        <div id="timer-display" aria-live="off" aria-label="Game timer">3:00</div>
        <button id="pause-btn" class="btn btn-small" aria-label="Pause game">≡</button>
      </div>
    </div>

    <!-- Arena -->
    <div id="arena-container">
      <div id="arena">
        <!-- Obstacles -->
        <div class="obstacle bed" id="bed-tl"></div>
        <div class="obstacle bed" id="bed-tr"></div>
        <div class="obstacle bed" id="bed-bl"></div>
        <div class="obstacle bed" id="bed-br"></div>
        <div class="obstacle table" id="table-center"></div>

        <!-- Players and projectiles will be added dynamically -->
      </div>
    </div>

    <!-- HUD Bottom - Scoreboard -->
    <div id="hud-bottom">
      <div id="scoreboard">
        <!-- Player status items will be inserted here -->
      </div>
    </div>

    <!-- Countdown Overlay -->
    <div id="countdown-overlay" class="overlay" role="alert" aria-live="assertive">
      <div class="countdown-content">
        <p class="countdown-label">Get Ready</p>
        <div id="countdown-number" aria-label="Countdown">3</div>
      </div>
    </div>

    <!-- Pause Menu Overlay -->
    <div id="pause-overlay" class="overlay" role="dialog" aria-modal="true" aria-labelledby="pause-menu-title">
      <div class="pause-menu">
        <h2 id="pause-menu-title">Game Paused</h2>
        <p id="paused-by-text" aria-live="polite">Paused by: Player</p>
        <button id="resume-btn" class="btn btn-primary" aria-label="Resume game">Resume</button>
        <button id="quit-btn" class="btn btn-danger" aria-label="Quit to lobby">Quit to Lobby</button>
      </div>
    </div>
  </div>

  <!-- Game Over Screen -->
  <div id="gameover-screen" class="screen">
    <div class="gameover-container">
      <p class="gameover-label">Game Over</p>
      <h1 id="winner-text">Player Wins!</h1>

      <div class="scoreboard-table">
        <div id="final-scoreboard">
          <!-- Final scores will be inserted here -->
        </div>
      </div>

      <div class="gameover-buttons">
        <button id="play-again-btn" class="btn btn-primary" aria-label="Return to lobby and play again">Play Again</button>
      </div>

      <p id="auto-return-text" class="status-message">Returning to lobby in 30s...</p>
    </div>
  </div>

  <!-- Notifications -->
  <div id="notifications" aria-live="polite" role="status"></div>

  <!-- Scripts -->
  <script src="socket.io/socket.io.js"></script>
  <script src="shared/constants.js"></script>
  <script src="shared/geometry.js"></script>
  <script src="shared/names.js"></script>
  <script type="module" src="js/main.js"></script>
</body>
</html>
